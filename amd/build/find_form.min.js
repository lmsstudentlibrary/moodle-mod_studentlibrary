define("mod_studentlibrary/find_form",["exports","jquery"],(function(_exports,_jquery){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.init=(serverapi,kits_select,div_select,headerContent,search_button,add_button,search_bar,lang)=>{(0,_jquery.default)("#search_button").on("click",(function(){let dialogDom=document.getElementsByClassName("search-book-dialogue");for(let i=0;i<dialogDom.length;i++)"true"==dialogDom[i].getAttribute("aria-hidden")&&dialogDom[i].remove();const ssr=this.getAttribute("ssr_p");let content;content=Y.Node.create('<div class = "book-dialog" id = "book-dialog"><div class="book-search-form" id="book-search-form"><div class="book_search_form_filter" id="book_search_form_filter"></div></div><hr /><div class="book-search-list" id="book-search-list"></div><div class="book-pagination" id="book-pagination"></div><hr /><div class="book_button" id="book_button" align="center"></div></div>');let search_form=content.one("#book-search-form"),search_form_filter=content.one("#book_search_form_filter"),book_button=content.one("#book_button"),kitsSelect=Y.Node.create("<div><p>"+kits_select+'</p><select id="kits_select" class="kits_select custom-select"></select></div>'),kitsSelectOne=kitsSelect.one("#kits_select");const kitsURL=serverapi+"db?SSr="+ssr+"&guide=sengine&cmd=sel&tag=all_agreement_kits";let kitsHttp=new XMLHttpRequest;kitsHttp.open("GET",kitsURL,!1),kitsHttp.send(null);const kitsArray=convertStringToXML(kitsHttp.responseText).getElementsByTagName("kit");let divSelect=Y.Node.create("<div><p>"+div_select+'</p><select id="div_select" class="div_select custom-select"></select></div>'),divSelectOne=divSelect.one("#div_select");for(let i=0;i<kitsArray.length;i++){let option=document.createElement("option");option.value=kitsArray[i].getAttribute("id");let KitDataList=GetKitData(serverapi,ssr,kitsArray[i].getAttribute("id"));const divArray=KitDataList.getElementsByTagName("division");if(0==i)for(let j=0;j<divArray.length;j++){let option=document.createElement("option");option.value=divArray[j].getAttribute("id");let divData=GetDivFullName(serverapi,ssr,divArray[j].getAttribute("id"),lang);option.text=divData,divSelectOne.appendChild(option)}option.text=KitDataList.getElementsByTagName("name")[0].getElementsByTagName("string")[0].innerHTML,kitsSelectOne.appendChild(option)}search_form_filter.appendChild(kitsSelect),search_form_filter.appendChild(divSelect);let addkit=Y.Node.create('<button class="btn btn-primary addbook" name="submitbutton_kit" id="id_submitbutton_lit">Добавить ссылку на комплект</button>');addkit.on("click",(function(){const kits_select=document.getElementById("kits_select");kits_select?(document.getElementById("id_booke").value="switch_kit/"+kits_select.value,dialogRef.dialog.destroy()):window.console.log("no book selected")})),search_form_filter.appendChild(addkit);let input_book_search=Y.Node.create("<div><p>"+search_bar+'</p><input type="text" id="input_book_search" class="input_book_search custom-select" placeholder="Реанимация, Пропедевтика"></div>');search_form.appendChild(input_book_search);let button_book_search=Y.Node.create('<button type="button" id="button_book_search" class="button_book_search btn btn-outline-primary">'+search_button+"</button>");button_book_search.on("click",(function(){let search_input=document.getElementById("input_book_search").value;const div_select=document.getElementById("div_select").value;document.getElementById("book-search-list").innerHTML="";const searchURL=serverapi+"db?SSr="+ssr+"&cmd=sel&guide=sengine&tag=kwords_search&paginate=6&div="+div_select+'&kwords="'+search_input+'"';let xmlHttp=new XMLHttpRequest;xmlHttp.open("GET",searchURL,!1),xmlHttp.send(null),BuildBooksList(serverapi,ssr,xmlHttp.responseText,6,serverapi)}));let addbook=Y.Node.create('<button class="btn btn-primary addbook" name="submitbutton_book" id="id_submitbutton_book">'+add_button+"</button>");addbook.on("click",(function(){const BookData=document.querySelector("input[name=radio-card-input]:checked");BookData?(document.getElementById("id_booke").value=BookData.value,dialogRef.dialog.destroy()):window.console.log("no book selected")})),book_button.appendChild(addbook),kitsSelectOne.on("change",(function(){const selectKit=document.getElementById("kits_select").value;let divSelectOne=document.getElementById("div_select");divSelectOne.innerHTML="";const divArray=GetKitData(serverapi,ssr,selectKit).getElementsByTagName("division");for(let j=0;j<divArray.length;j++){let option=document.createElement("option");option.value=divArray[j].getAttribute("id");let divData=GetDivFullName(serverapi,ssr,divArray[j].getAttribute("id"),lang);option.text=divData,divSelectOne.appendChild(option)}})),search_form.appendChild(button_book_search);let dialogRef={dialog:null},config={headerContent:headerContent,bodyContent:content,additionalBaseClass:"search-book-dialogue",draggable:!0,modal:!0,closeButton:!0,width:"50%"};dialogRef.dialog=new M.core.dialogue(config),dialogRef.dialog.show()})),(0,_jquery.default)("#id_booke").on("change",(function(){const ssr=this.getAttribute("ssr_o"),id_error_booke=document.getElementById("id_error_booke");id_error_booke.innerHTML="",id_error_booke.style.display="none";let book_id_text=this.value;if(book_id_text.indexOf("/doc/")>=0){const BookID=FainfBookId(book_id_text,book_id_text.indexOf("/doc/")+1,book_id_text.indexOf(".html"));this.value=BookID,GetBookData(serverapi,ssr,BookID)?window.console.log("book_id ok"):(window.console.log("book_id no"),id_error_booke.innerHTML="Такой идентификатор не найден",id_error_booke.style.display="block")}else if(book_id_text.indexOf("/book/")>=0){const BookID=FainfBookId(book_id_text,book_id_text.indexOf("/book/")+1,book_id_text.indexOf(".html"));this.value=BookID,GetBookData(serverapi,ssr,BookID)?window.console.log("book_id ok"):(window.console.log("book_id no"),id_error_booke.innerHTML="Такой идентификатор не найден",id_error_booke.style.display="block")}else if(0===book_id_text.indexOf("doc/")){const BookID=FainfBookId(book_id_text,0,book_id_text.indexOf(".html"));this.value=BookID,GetBookData(serverapi,ssr,BookID)?window.console.log("book_id ok"):(window.console.log("book_id no"),id_error_booke.innerHTML="Такой идентификатор не найден",id_error_booke.style.display="block")}else if(0===book_id_text.indexOf("book/")){const BookID=FainfBookId(book_id_text,0,book_id_text.indexOf(".html"));this.value=BookID,GetBookData(serverapi,ssr,BookID)?window.console.log("book_id ok"):(window.console.log("book_id no"),id_error_booke.innerHTML="Такой идентификатор не найден",id_error_booke.style.display="block")}else id_error_booke.innerHTML="Не верный идентификатор книги",id_error_booke.style.display="block"}))};const FainfBookId=function(str,text_s,test_f){let new_text_s=text_s,new_text_f=test_f;return-1===test_f&&(new_text_f=str.length),str.substring(new_text_s,new_text_f)},cardclick=book_id=>{unclickRadio(),removeActive(),makeActive(book_id),clickRadio(book_id)},unclickRadio=()=>{(0,_jquery.default)("input:radio").prop("checked",!1)},clickRadio=inputElement=>{(0,_jquery.default)("#"+inputElement).prop("checked",!0)},removeActive=()=>{(0,_jquery.default)(".card").removeClass("active")},makeActive=element=>{(0,_jquery.default)("#"+element+"-card").addClass("active")},convertStringToXML=xmlString=>(new DOMParser).parseFromString(xmlString,"text/xml"),GetKitData=(server,ssr,selectKit)=>{const divURL=server+"db?SSr="+ssr+"&guide=sengine&cmd=sel&tag=kit_content&kit="+selectKit;let xmlHttp=new XMLHttpRequest;return xmlHttp.open("GET",divURL,!1),xmlHttp.send(null),convertStringToXML(xmlHttp.responseText)},GetDivFullName=function(server,ssr,divID){let page=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,leng=arguments.length>4?arguments[4]:void 0,divDataURL=server+"db?SSr="+ssr+"&guide=sengine&cmd=sel&tag=division_books&div="+divID;0!==page?divDataURL=divDataURL+"&paginate="+page:divDataURL+="&paginate=1";let xmlHttp=new XMLHttpRequest;xmlHttp.open("GET",divDataURL,!1),xmlHttp.send(null);const divData=convertStringToXML(xmlHttp.responseText),full_name_list=divData.getElementsByTagName("full_name");if(full_name_list.length>0){const divName_stringlist=full_name_list[0].querySelector('[language="'.concat(leng,'"]'));return null!==divName_stringlist?divName_stringlist.innerHTML:full_name_list[0].getElementsByTagName("string")[0].innerHTML}return divID},BuildBooksList=function(server,ssr,xmlString,pagination,serverapi){let book_total=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,res_id=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,book_search_list=document.getElementById("book-search-list"),book_pagination=document.getElementById("book-pagination");book_search_list.innerHTML="",book_pagination.innerHTML="";let xmlDoc=convertStringToXML(xmlString),bookList=xmlDoc.getElementsByTagName("data");-1===res_id&&(res_id=xmlDoc.getElementsByTagName("res_id")[0].innerHTML),-1===book_total&&(book_total=xmlDoc.getElementsByTagName("total")[0].innerHTML);let page=document.getElementById("book-pagination").getAttribute("page");if(null===page&&(page=1),bookList.length>0){for(let i=0;i<bookList.length;i++){let BookID=bookList[i].innerHTML;if("book"===BookID.split("/")[0]){let Book=BuildBook(server,ssr,BookID);book_search_list.appendChild(Book)}else if("doc"===BookID.split("/")[0]){let Book=BuildDoc(server,ssr,BookID);book_search_list.appendChild(Book)}}const navBar=BuildBookPagination(res_id,ssr,pagination,book_total,page,serverapi);book_pagination.appendChild(navBar)}else{const notFaund_div=document.createElement("div"),notFaund_p=document.createElement("p");notFaund_p.innerText="Not Found",notFaund_div.appendChild(notFaund_p),book_search_list.appendChild(notFaund_div)}},BuildBook=(server,ssr,BookID)=>{let GetBookDataURL=server+"db?SSr="+ssr+"&guide="+BookID.split("/")[0]+"&cmd=data&id="+BookID.split("/")[1]+"&img_src_form=b64",xmlHttp=new XMLHttpRequest;xmlHttp.open("GET",GetBookDataURL,!1),xmlHttp.send(null);let BookData=convertStringToXML(xmlHttp.responseText),meta=BookData.getElementsByTagName("meta")[0];let div_book_list_item=document.createElement("div");return div_book_list_item.innerHTML='<label class="radio-card"><input type="radio" name="radio-card-input" class="radio-card-input"/><div class="card-content-wrapper"><span class="check-icon"></span><div class="card-content"><img></img><div class="metadata"><div class="title"></div><div class="authors"></div><div class="doc_name"></div></div></div></div></label>',div_book_list_item.getElementsByClassName("radio-card")[0].setAttribute("for",BookID.split("/")[1]),div_book_list_item.getElementsByClassName("radio-card-input")[0].setAttribute("id",BookID.split("/")[1]),BookData.getElementsByTagName("title")[0].getElementsByTagName("string").length>0&&(div_book_list_item.getElementsByClassName("title")[0].innerHTML=ReplaceCDATA(BookData.getElementsByTagName("title")[0].getElementsByTagName("string")[0].innerHTML)),meta.querySelectorAll('[name="authors"]')[0].getElementsByTagName("string").length>0&&(div_book_list_item.getElementsByClassName("authors")[0].innerHTML=ReplaceCDATA(meta.querySelectorAll('[name="authors"]')[0].getElementsByTagName("string")[0].innerHTML)),div_book_list_item.getElementsByClassName("radio-card-input")[0].value=BookID,div_book_list_item.getElementsByClassName("radio-card")[0].onclick=function(){cardclick(BookID.split("/")[1])},div_book_list_item.getElementsByTagName("img")[0].setAttribute("src",BookData.getElementById("avatar").getAttribute("src")),div_book_list_item},BuildDoc=(server,ssr,BookID)=>{let NewBookID=GetBookIdbyDocId(server,ssr,BookID);if(null!==NewBookID){let GetBookDataURL=server+"db?SSr="+ssr+"&guide=book&cmd=data&id="+NewBookID+"&img_src_form=b64",xmlHttp=new XMLHttpRequest;xmlHttp.open("GET",GetBookDataURL,!1),xmlHttp.send(null);let BookData=convertStringToXML(xmlHttp.responseText);if(BookData.getElementsByTagName("meta").length>0){let meta=BookData.getElementsByTagName("meta")[0];const book_list_item='<label class="radio-card"><input type="radio" name="radio-card-input" class="radio-card-input"/><div class="card-content-wrapper"><span class="check-icon"></span><div class="card-content"><img></img><div class="metadata"><div class="doc_name"></div><div class="title"></div><div class="authors"></div></div></div></div></label>';let div_book_list_item=document.createElement("div");return div_book_list_item.innerHTML=book_list_item,div_book_list_item.getElementsByClassName("radio-card")[0].setAttribute("for",BookID.split("/")[1]+"_"+BookID.split("/")[2]),div_book_list_item.getElementsByClassName("radio-card-input")[0].setAttribute("id",BookID.split("/")[1]+"_"+BookID.split("/")[2]),BookData.getElementsByTagName("title")[0].getElementsByTagName("string").length>0&&(div_book_list_item.getElementsByClassName("title")[0].innerHTML=ReplaceCDATA(BookData.getElementsByTagName("title")[0].getElementsByTagName("string")[0].innerHTML)),BookID.split("/")[2]?div_book_list_item.getElementsByClassName("doc_name")[0].innerHTML=ReplaceCDATA(BookData.getElementById(BookID.split("/")[1]).getElementsByTagName("string")[0].innerHTML)+" стр. "+BookID.split("/")[2]:div_book_list_item.getElementsByClassName("doc_name")[0].innerHTML=ReplaceCDATA(BookData.getElementById(BookID.split("/")[1]).getElementsByTagName("string")[0].innerHTML),meta.querySelectorAll('[name="authors"]')[0].getElementsByTagName("string").length>0&&(div_book_list_item.getElementsByClassName("authors")[0].innerHTML=ReplaceCDATA(meta.querySelectorAll('[name="authors"]')[0].getElementsByTagName("string")[0].innerHTML)),div_book_list_item.getElementsByClassName("radio-card-input")[0].value=BookID,div_book_list_item.getElementsByClassName("radio-card")[0].onclick=function(){cardclick(BookID.split("/")[1]+"_"+BookID.split("/")[2])},div_book_list_item.getElementsByTagName("img")[0].setAttribute("src",BookData.getElementById("avatar").getAttribute("src")),div_book_list_item}return document.createElement("div")}return document.createElement("div")},ReplaceCDATA=str=>str.replace("<![CDATA[","").replace("]]>",""),PaginationClick=(ssr,res_id,page,pagination,serverapi,total)=>{document.getElementById("book-search-list").innerHTML="";const searchURL=serverapi+"db?SSr="+ssr+"&cmd=more&guide=sengine&res_id="+res_id+"&from="+(page-1)*pagination;let xmlHttp=new XMLHttpRequest;xmlHttp.open("GET",searchURL,!1),xmlHttp.send(null),document.getElementById("book-pagination").setAttribute("page",page),BuildBooksList(serverapi,ssr,xmlHttp.responseText,pagination,serverapi,total,res_id)},BuildBookPagination=function(res_id,ssr,pagination,total){let page=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,serverapi=arguments.length>5?arguments[5]:void 0;const pageCount=Math.ceil(total/pagination);let nav_bar=document.createElement("div");nav_bar.id="book_nav_bar",nav_bar.classList.add("book_nav_bar"),nav_bar.classList.add("pagination"),nav_bar.classList.add("pagination-centered"),nav_bar.classList.add("justify-content-center");let nav_bar_ul=document.createElement("ui");if(nav_bar_ul.classList.add("pagination"),nav_bar_ul.setAttribute("data-page-size",20),pageCount>1){if(page>1){let previous_page=document.createElement("li");previous_page.classList.add("page-item"),previous_page.classList.add("page-item-book"),previous_page.onclick=function(){PaginationClick(ssr,res_id,Number(page)-1,pagination,serverapi,total)};let previous_page_a=document.createElement("a");previous_page_a.classList.add("page-link"),previous_page_a.setAttribute("page",Number(page)-1),previous_page_a.innerHTML='<span aria-hidden="true">«</span>',previous_page.appendChild(previous_page_a),nav_bar_ul.appendChild(previous_page)}let first_page=document.createElement("li");first_page.classList.add("page-item"),first_page.classList.add("page-item-book"),1==page&&first_page.classList.add("active"),first_page.onclick=function(){PaginationClick(ssr,res_id,1,pagination,serverapi,total)};let first_page_a=document.createElement("a");if(first_page_a.classList.add("page-link"),first_page_a.setAttribute("page",1),first_page_a.innerHTML='<span aria-hidden="true">1</span>',first_page.appendChild(first_page_a),nav_bar_ul.appendChild(first_page),page>3){let previous_one_page_space=document.createElement("li");previous_one_page_space.classList.add("page-item"),previous_one_page_space.classList.add("disabled"),previous_one_page_space.classList.add("page-item-book");let previous_one_page_space_a=document.createElement("a");previous_one_page_space_a.classList.add("page-link"),previous_one_page_space_a.innerHTML='<span aria-hidden="true">...</span>',previous_one_page_space.appendChild(previous_one_page_space_a),nav_bar_ul.appendChild(previous_one_page_space)}if(page>2){let previous_one_page=document.createElement("li");previous_one_page.classList.add("page-item"),previous_one_page.classList.add("page-item-book"),previous_one_page.onclick=function(){PaginationClick(ssr,res_id,Number(page)-1,pagination,serverapi,total)};let previous_one_page_a=document.createElement("a");previous_one_page_a.classList.add("page-link"),previous_one_page_a.setAttribute("page",Number(page)-1),previous_one_page_a.innerHTML='<span aria-hidden="true">'+(Number(page)-1)+"</span>",previous_one_page.appendChild(previous_one_page_a),nav_bar_ul.appendChild(previous_one_page)}if(page>1&&page<Number(pageCount)){let Current_one_page=document.createElement("li");Current_one_page.classList.add("page-item"),Current_one_page.classList.add("page-item-book"),Current_one_page.classList.add("active");let Current_one_page_a=document.createElement("a");Current_one_page_a.classList.add("page-link"),Current_one_page_a.innerHTML='<span aria-hidden="true">'+Number(page)+"</span>",Current_one_page.appendChild(Current_one_page_a),nav_bar_ul.appendChild(Current_one_page)}if(page<Number(pageCount)-1){let next_one_page=document.createElement("li");next_one_page.classList.add("page-item"),next_one_page.classList.add("page-item-book"),next_one_page.onclick=function(){PaginationClick(ssr,res_id,Number(page)+1,pagination,serverapi,total)};let next_one_page_a=document.createElement("a");next_one_page_a.classList.add("page-link"),next_one_page_a.setAttribute("page",Number(page)+1),next_one_page_a.innerHTML='<span aria-hidden="true">'+(Number(page)+1)+"</span>",next_one_page.appendChild(next_one_page_a),nav_bar_ul.appendChild(next_one_page)}if(page<Number(pageCount)-2){let next_one_page_space=document.createElement("li");next_one_page_space.classList.add("page-item"),next_one_page_space.classList.add("disabled"),next_one_page_space.classList.add("page-item-book");let next_one_page_space_a=document.createElement("a");next_one_page_space_a.classList.add("page-link"),next_one_page_space_a.innerHTML='<span aria-hidden="true">...</span>',next_one_page_space.appendChild(next_one_page_space_a),nav_bar_ul.appendChild(next_one_page_space)}let last_page=document.createElement("li");last_page.classList.add("page-item"),last_page.classList.add("page-item-book"),last_page.onclick=function(){PaginationClick(ssr,res_id,pageCount,pagination,serverapi,total)},page==pageCount&&last_page.classList.add("active");let last_page_a=document.createElement("a");if(last_page_a.classList.add("page-link"),last_page_a.setAttribute("page",pageCount),last_page_a.innerHTML='<span aria-hidden="true">'+pageCount+"</span>",last_page.appendChild(last_page_a),nav_bar_ul.appendChild(last_page),page<pageCount){let next_page=document.createElement("li");next_page.classList.add("page-item"),next_page.classList.add("page-item-book"),next_page.onclick=function(){PaginationClick(ssr,res_id,Number(page)+1,pagination,serverapi,total)};let next_page_a=document.createElement("a");next_page_a.classList.add("page-link"),last_page_a.setAttribute("page",Number(page)+1),next_page_a.innerHTML='<span aria-hidden="true">»</span>',next_page.appendChild(next_page_a),nav_bar_ul.appendChild(next_page)}}return document.getElementById("book-pagination").setAttribute("page",page),nav_bar.appendChild(nav_bar_ul),nav_bar},GetBookIdbyDocId=(server,ssr,BookID)=>{let master_book_data_URL=server+"db?SSr="+ssr+"&guide=doc&cmd=data&id="+BookID.split("/")[1]+"&tag=master_book_data",xmlHttp=new XMLHttpRequest;xmlHttp.open("GET",master_book_data_URL,!1),xmlHttp.send(null);let BookData=convertStringToXML(xmlHttp.responseText).getElementsByTagName("book");return BookData.length>0?BookData[0].getAttribute("id"):null},GetBookData=(server,ssr,BookID)=>{let GetBookDataURL=server+"db?SSr="+ssr+"&guide="+BookID.split("/")[0]+"&cmd=data&id="+BookID.split("/")[1]+"&img_src_form=b64",xmlHttp=new XMLHttpRequest;return xmlHttp.open("GET",GetBookDataURL,!1),xmlHttp.send(null),convertStringToXML(xmlHttp.responseText).getElementsByTagName("title").length>0}}));

//# sourceMappingURL=find_form.min.js.map